# ๐ ุชูุฑูุฑ ุงูุฅุตูุงุญุงุช ูุงูุชุทููุฑุงุช ุงูููุชุฑุญุฉ
## ูุธุงู ุญุงุณุจุฉ ุงูุชูููู

---

## โ **ุงูุฅุตูุงุญุงุช ุงูุชู ุชู ุชูููุฐูุง:**

### 1๏ธโฃ **ุฅุตูุงุญ ูุดููุฉ UNIQUE constraint ูู ูููุฐุฌ ุฅุถุงูุฉ ุนููู** โ

#### ุงููุดููุฉ:
```json
{"success":false,"error":"D1_ERROR: UNIQUE constraint failed: customers.national_id: SQLITE_CONSTRAINT"}
```

#### ุงูุญู ุงููุทุจู:
- โ ุฅุถุงูุฉ ูุญุต **ูุจู ุงูุฅุฏุฎุงู** ููุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ุฑูู ุงููููุฉ
- โ ุฅุถุงูุฉ ูุญุต ููุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ุฑูู ุงููุงุชู
- โ ุนุฑุถ **ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ** ูููุณุชุฎุฏู
- โ ุฅุธูุงุฑ ูุนูููุงุช ุงูุนููู ุงูููุฌูุฏ (ุงูุงุณูุ ุฑูู ุงููููุฉุ ุฑูู ุงูุนููู)
- โ ุชูููุฑ **3 ุฎูุงุฑุงุช ูููุณุชุฎุฏู:**
  - ุงูุนูุฏุฉ ูููููุฐุฌ ูุชุนุฏูู ุงูุจูุงูุงุช
  - ุนุฑุถ ุงูุนููู ุงูููุฌูุฏ
  - ุงูุฐูุงุจ ููุงุฆูุฉ ุงูุนููุงุก

#### ูุซุงู ุนูู ุงูุฑุณุงูุฉ ุงูุฌุฏูุฏุฉ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ุฑูู ุงููููุฉ ููุฑุฑ!                   โ
โ ูุง ูููู ุฅุถุงูุฉ ุนููู ุจุฑูู ูููุฉ ููุฌูุฏ ูุณุจูุงูโ
โ                                         โ
โ ุงูุฑูู ุงููุทูู: 1234567890              โ
โ ูุณุฌู ุจุงุณู: ุฃุญูุฏ ูุญูุฏ ุงูุณุนูุฏ           โ
โ ุฑูู ุงูุนููู: #5                         โ
โ                                         โ
โ [ุงูุนูุฏุฉ ูููููุฐุฌ] [ุนุฑุถ ุงูุนููู] [ุงููุงุฆูุฉ]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### 2๏ธโฃ **ุฅุตูุงุญ ูุดููุฉ ูุณุจ ุงูุชูููู ุชุธูุฑ ุฃุตูุงุฑ** โ

#### ุงููุดููุฉ:
- ูุณุจ ุงูุชูููู ูุงูุช ุชุธูุฑ `0%` ุจุฏูุงู ูู ุงูููู ุงูุญููููุฉ (4.5%, 3.8%, ุฅูุฎ)

#### ุงูุณุจุจ:
- ุงูููุฏ ูุงู ูุณุชุฎุฏู `interest_rate` ุจูููุง ุงุณู ุงูุนููุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู `rate`

#### ุงูุญู ุงููุทุจู:
- โ ุชุตุญูุญ ุฌููุน ุงุณุชุฎุฏุงูุงุช `interest_rate` ุฅูู `rate` ูู:
  - ุตูุญุฉ ุนุฑุถ ุงููุณุจ (Rates List)
  - ุตูุญุฉ ุชูุงุตูู ุงููุณุจุฉ (Rate Details)
  - ุชุตุฏูุฑ Excel/CSV
- โ ุชู ุงุฎุชุจุงุฑ ุงูุจูุงูุงุช ูุงูุชุฃูุฏ ูู ุตุญุชูุง

#### ุงูุจูุงูุงุช ุงูุญููููุฉ ุงูุขู:
```
ุงูุจูู ุงูุฃููู - ุชูููู ุดุฎุตู: 4.5%
ุงูุจูู ุงูุฃููู - ุชูููู ุนูุงุฑู: 3.8%
ุงูุฑุงุฌุญู - ุชูููู ุดุฎุตู: 4.2%
ุงูุฑุงุฌุญู - ุชูููู ุนูุงุฑู: 3.5%
```

---

### 3๏ธโฃ **ูุธุงู ุงููุฑููุงุช ุฌุงูุฒ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช** โ

#### ูุง ูู ููุฌูุฏ:
- โ ุฌุฏูู `financing_requests` ูุญุชูู ุนูู ุฃุนูุฏุฉ ุงููุฑููุงุช:
  - `id_attachment_url` - ุตูุฑุฉ ุงููููุฉ
  - `salary_attachment_url` - ุตูุฑุฉ ููุฑุฏุงุช ุงูุฑุงุชุจ
  - `bank_statement_attachment_url` - ูุดู ุญุณุงุจ ุจููู
  - `additional_attachment_url` - ูุฑููุงุช ุฅุถุงููุฉ

#### ูุง ูุญุชุงุฌ ููุชุทููุฑ:
- โณ ุฅุถุงูุฉ ูุงุฌูุฉ ุฑูุน ุงููููุงุช (File Upload)
- โณ ุฑุจุท ุงููููุฐุฌ ุจุงูู API
- โณ ุนุฑุถ ุงููุฑููุงุช ูู ุตูุญุฉ ุชูุงุตูู ุงูุทูุจ

---

## ๐ **ุงูุชุทููุฑุงุช ุงูููุชุฑุญุฉ (ุฎุงุฑุทุฉ ุงูุทุฑูู):**

### **ุงููุฑุญูุฉ 1: ูุธุงู ุงููุฑููุงุช (ุงูุฃููููุฉ: ุนุงููุฉ ุฌุฏุงู)** ๐ด

#### 1.1 ุฅุถุงูุฉ ูุงุฌูุฉ ุฑูุน ุงููููุงุช ูู ูููุฐุฌ ุทูุจ ุงูุชูููู:
```html
<!-- ูู ูููุฐุฌ /admin/requests/new -->
<div class="border-2 border-dashed border-gray-300 rounded-lg p-6">
  <h3>๐ ุงููุฑููุงุช ุงููุทููุจุฉ</h3>
  
  <div>
    <label>ุตูุฑุฉ ุงููููุฉ ุงููุทููุฉ *</label>
    <input type="file" name="id_attachment" accept="image/*,application/pdf">
  </div>
  
  <div>
    <label>ููุฑุฏุงุช ุงูุฑุงุชุจ (ุขุฎุฑ 3 ุฃุดูุฑ) *</label>
    <input type="file" name="salary_attachment" accept="image/*,application/pdf">
  </div>
  
  <div>
    <label>ูุดู ุญุณุงุจ ุจููู (ุขุฎุฑ 6 ุฃุดูุฑ)</label>
    <input type="file" name="bank_statement" accept="image/*,application/pdf">
  </div>
  
  <div>
    <label>ูุฑููุงุช ุฅุถุงููุฉ (ุฅู ูุฌุฏุช)</label>
    <input type="file" name="additional_attachment" accept="image/*,application/pdf">
  </div>
</div>
```

#### 1.2 ุงุณุชุฎุฏุงู Cloudflare R2 Storage ูุญูุธ ุงููููุงุช:
```typescript
// ูู wrangler.jsonc
{
  "r2_buckets": [
    {
      "binding": "ATTACHMENTS",
      "bucket_name": "tamweel-attachments"
    }
  ]
}

// ูู src/index.tsx
app.post('/api/requests', async (c) => {
  const formData = await c.req.formData()
  const idFile = formData.get('id_attachment') as File
  
  // ุฑูุน ุงูููู ุฅูู R2
  const key = `requests/${Date.now()}_${idFile.name}`
  await c.env.ATTACHMENTS.put(key, idFile)
  
  // ุญูุธ ุฑุงุจุท ุงูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const id_attachment_url = `https://storage.example.com/${key}`
  // ...
})
```

#### 1.3 ุนุฑุถ ุงููุฑููุงุช ูู ุตูุญุฉ ุงูุชูุงุตูู:
```html
<div class="bg-white rounded-lg p-6">
  <h3>๐ ุงููุฑููุงุช</h3>
  
  <div class="grid grid-cols-2 gap-4">
    <a href="..." target="_blank" class="...">
      <i class="fas fa-id-card"></i>
      ุตูุฑุฉ ุงููููุฉ
      <i class="fas fa-download"></i>
    </a>
    
    <a href="..." target="_blank" class="...">
      <i class="fas fa-file-invoice-dollar"></i>
      ููุฑุฏุงุช ุงูุฑุงุชุจ
      <i class="fas fa-download"></i>
    </a>
    
    <!-- ุฅูุฎ... -->
  </div>
</div>
```

---

### **ุงููุฑุญูุฉ 2: ููุญุฉ ุชุญูู ูุชูุฏูุฉ (ุงูุฃููููุฉ: ุนุงููุฉ)** ๐

#### 2.1 ุฅุญุตุงุฆูุงุช ุดุงููุฉ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:
- ๐ ุนุฏุฏ ุงูุทูุจุงุช ุญุณุจ ุงูุญุงูุฉ (ููุจููุ ููุฏ ุงููุฑุงุฌุนุฉุ ูุฑููุถ)
- ๐ ุฑุณูู ุจูุงููุฉ ููุทูุจุงุช ุงูุดูุฑูุฉ
- ๐ฐ ุฅุฌูุงูู ุงูุชููููุงุช ุงููุทููุจุฉ vs ุงููุนุชูุฏุฉ
- ๐ฆ ุฃูุซุฑ ุงูุจููู ุทูุจุงู
- ๐ ูุณุจุฉ ุงููุจูู ุงูุฅุฌูุงููุฉ

#### 2.2 ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช:
```typescript
// ุตูุญุฉ ุชูุงุฑูุฑ ุฌุฏูุฏุฉ
app.get('/admin/reports', async (c) => {
  // ุชูุฑูุฑ ุงูุทูุจุงุช ุญุณุจ ุงูุญุงูุฉ
  // ุชูุฑูุฑ ุงูุทูุจุงุช ุญุณุจ ุงูุจูู
  // ุชูุฑูุฑ ุงูุทูุจุงุช ุญุณุจ ููุน ุงูุชูููู
  // ุชูุฑูุฑ ุงูุทูุจุงุช ุญุณุจ ุงููุฏุฉ
})
```

---

### **ุงููุฑุญูุฉ 3: ุชุญุณููุงุช ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ุงูุฃููููุฉ: ูุชูุณุทุฉ)** ๐ก

#### 3.1 ุญุงุณุจุฉ ุชูููู ุชูุงุนููุฉ:
```html
<div class="calculator">
  <input type="number" id="amount" placeholder="ุงููุจูุบ ุงููุทููุจ">
  <input type="number" id="duration" placeholder="ุงููุฏุฉ ุจุงูุฃุดูุฑ">
  <select id="bank">...</select>
  <select id="financingType">...</select>
  
  <button onclick="calculate()">ุงุญุณุจ</button>
  
  <div class="results">
    <p>ุงููุณุท ุงูุดูุฑู: <strong id="monthly">0</strong> ุฑูุงู</p>
    <p>ูุณุจุฉ ุงููุงุฆุฏุฉ: <strong id="rate">0</strong>%</p>
    <p>ุงูุฅุฌูุงูู: <strong id="total">0</strong> ุฑูุงู</p>
  </div>
</div>
```

#### 3.2 ูุธุงู ุงูุฅุดุนุงุฑุงุช:
- ๐ ุฅุดุนุงุฑ ุนูุฏ ุฅุถุงูุฉ ุทูุจ ุฌุฏูุฏ
- ๐ ุฅุดุนุงุฑ ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ
- ๐ ุฅุดุนุงุฑ ุนูุฏ ุงูุชุฑุงุจ ุงูุชูุงุก ุงุดุชุฑุงู ุดุฑูุฉ

#### 3.3 ูุธุงู ุงูุชุนูููุงุช ูุงูููุงุญุธุงุช:
```sql
CREATE TABLE request_notes (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  request_id INTEGER NOT NULL,
  user_id INTEGER NOT NULL,
  note_text TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (request_id) REFERENCES financing_requests(id),
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

### **ุงููุฑุญูุฉ 4: ุงูุฃูุงู ูุงูุตูุงุญูุงุช (ุงูุฃููููุฉ: ูุชูุณุทุฉ)** ๐ก

#### 4.1 ุชุทุจูู ูุธุงู ุงูุตูุงุญูุงุช ุงูููุฌูุฏ:
- โ ุงูุตูุงุญูุงุช ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (39 ุตูุงุญูุฉ)
- โณ ุชุทุจูู middleware ููุชุญูู ูู ุงูุตูุงุญูุงุช
- โณ ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ูุงูููุงุฆู ุญุณุจ ุงูุตูุงุญูุงุช

#### 4.2 ูุธุงู ุณุฌู ุงูุฃุญุฏุงุซ (Audit Log):
```sql
CREATE TABLE audit_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  action TEXT NOT NULL, -- 'create', 'update', 'delete', 'view'
  table_name TEXT NOT NULL,
  record_id INTEGER,
  old_values TEXT, -- JSON
  new_values TEXT, -- JSON
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

### **ุงููุฑุญูุฉ 5: ุงูุชูุงูู ูุน ุฎุฏูุงุช ุฎุงุฑุฌูุฉ (ุงูุฃููููุฉ: ููุฎูุถุฉ)** ๐ข

#### 5.1 ุงูุชูุงูู ูุน Nafath (ุงูุชุญูู ูู ุงููููุฉ):
```typescript
// API ููุชุญูู ูู ุฑูู ุงููููุฉ
app.post('/api/verify-national-id', async (c) => {
  const { national_id } = await c.req.json()
  
  // ุงุณุชุฏุนุงุก API Nafath
  const response = await fetch('https://api.nafath.sa/verify', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ...' },
    body: JSON.stringify({ national_id })
  })
  
  return c.json(await response.json())
})
```

#### 5.2 ุงูุชูุงูู ูุน SIMAH (ุงูุงุณุชุนูุงู ุงูุงุฆุชูุงูู):
- ุงูุงุณุชุนูุงู ุนู ุงูุณุฌู ุงูุงุฆุชูุงูู ููุนููู
- ุนุฑุถ ุชูุฑูุฑ SIMAH ูู ุตูุญุฉ ุชูุงุตูู ุงูุนููู

#### 5.3 ุฅุฑุณุงู SMS ููุนููุงุก:
- ุฅุดุนุงุฑ ุนูุฏ ูุจูู/ุฑูุถ ุงูุทูุจ
- ุฑูุฒ ุงูุชุญูู (OTP) ุนูุฏ ุงูุชุณุฌูู

---

## ๐ **ููุฎุต ุงูุฃููููุงุช:**

| ุงููุฑุญูุฉ | ุงููุตู | ุงูุฃููููุฉ | ุงูููุช ุงููุชููุน |
|---------|-------|----------|--------------|
| **1** | ูุธุงู ุงููุฑููุงุช ุงููุงูู | ๐ด ุนุงููุฉ ุฌุฏุงู | 3-5 ุฃูุงู |
| **2** | ููุญุฉ ุชุญูู ูุชูุฏูุฉ | ๐ ุนุงููุฉ | 2-3 ุฃูุงู |
| **3** | ุชุญุณููุงุช ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู | ๐ก ูุชูุณุทุฉ | 3-4 ุฃูุงู |
| **4** | ุงูุฃูุงู ูุงูุตูุงุญูุงุช | ๐ก ูุชูุณุทุฉ | 2-3 ุฃูุงู |
| **5** | ุงูุชูุงูู ุงูุฎุงุฑุฌู | ๐ข ููุฎูุถุฉ | 5-7 ุฃูุงู |

---

## ๐ฏ **ุงูุชูุตูุงุช ุงูููุฑูุฉ:**

### ูุฌุจ ุงูุจุฏุก ุจูุง ุงูุขู:
1. โ **ูุธุงู ุงููุฑููุงุช** - ููู ุฌุฏุงู ููุนูููุฉ ุงููุนููุฉ
2. โ **ููุญุฉ ุงูุชุญูู ุงููุชูุฏูุฉ** - ูุณูููุฉ ูุชุงุจุนุฉ ุงูุฃุนูุงู
3. โ **ุญุงุณุจุฉ ุงูุชูููู** - ุฃุฏุงุฉ ูููุฏุฉ ููุนููุงุก

### ูููู ุชุฃุฌูููุง:
- โณ ุงูุชูุงูู ูุน Nafath ู SIMAH (ูุญุชุงุฌ ูุชุฑุฎูุต ูุชูููุฉ)
- โณ ูุธุงู SMS (ูุญุชุงุฌ ูุงุดุชุฑุงู ูู ุฎุฏูุฉ)

---

## ๐ **ุงูุฑูุงุจุท ุงููููุฉ:**

- ๐ **ููุญุฉ ุงูุชุญูู:** https://3000-ii8t2q2dzwwe7ckmslxss-3844e1b6.sandbox.novita.ai/admin
- ๐ฅ **ุงูุนููุงุก:** https://3000-ii8t2q2dzwwe7ckmslxss-3844e1b6.sandbox.novita.ai/admin/customers
- ๐ **ุงูุทูุจุงุช:** https://3000-ii8t2q2dzwwe7ckmslxss-3844e1b6.sandbox.novita.ai/admin/requests
- ๐ **ุงููุณุจ:** https://3000-ii8t2q2dzwwe7ckmslxss-3844e1b6.sandbox.novita.ai/admin/rates

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### ุชู ุงูุฅุตูุงุญ:
- โ ุฎุทุฃ UNIQUE constraint (ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ)
- โ ูุณุจ ุงูุชูููู ุชุธูุฑ ุจุดูู ุตุญูุญ (4.5%, 3.8%, ุฅูุฎ)
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ูููุฑููุงุช

### ุฌุงูุฒ ููุงุณุชุฎุฏุงู:
- โ ูุธุงู ุงูุจุญุซ ูุงูููุชุฑุฉ (7 ุตูุญุงุช)
- โ ูุธุงู ุงูุตูุงุญูุงุช (39 ุตูุงุญูุฉ)
- โ ุฌููุน ููุงุฐุฌ ุงูุฅุถุงูุฉ (6 ููุงุฐุฌ)
- โ ุฌููุน ุตูุญุงุช ุงูุนุฑุถ (5 ุตูุญุงุช)

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-12-15  
**ุงูุญุงูุฉ:** โ ุงูุฅุตูุงุญุงุช ููุชููุฉ - ุฌุงูุฒ ููุชุทููุฑ ุงูุชุงูู

---

๐ **ูุธุงู ุญุงุณุจุฉ ุงูุชูููู - ุฌุงูุฒ ููุงูุทูุงู!** ๐
